# Linux-specific settings, sourced by ~/.bashrc if current OS is Linux
#------------------------------------------------------------------------------#

# Ensure coloured output of 'ls'
alias ls='ls --color'

# Customise keyboard layout with setxkbmap:
#   - Add Swiss German keyboard layout
#   - Swap Caps-Lock and Ctrl keys
#   - Set key combination for toggling between keyboard layouts
# All the options and keyboard layouts of setxkbmap can be found in the file
# ==> /usr/share/X11/xkb/rules/base.lst
# Notes:
# - The settings made by setxkbmap do NOT persists across logins
# - To make the settigns persistent, one option would be to put the setxkbmap
#   commands directly into ~/.bashrc. However, this may cause an X error
#   (cannot open display "default display")
# - Another option would be to put the setxkbmap commands into ~/.xinitrc or
#   /etc/X11/xorg.conf.d/00-keyboard.conf (different syntax). However, there
#   are inconsistencies across systems, and different desktop environments
#   read these files in different ways
# - Because of the above problems, the setxkbmap commands are provided here
#   as a function that can be called manually
# Source: https://wiki.archlinux.org/index.php/Keyboard_configuration_in_Xorg
#         http://betabug.ch/blogs/ch-athens/1242
config_keyboard() {
  if $(which setxkbmap); then
    # Set Swiss German and German as keyboard layouts (ch(de) is default)
    setxkbmap 'ch(de),de'
    # Left Alt-Shift for toggling between keyboard layouts
    setxkbmap -option grp:lalt_lshift_toggle
    # Swap Caps-Lock and Ctrl keys
    setxkbmap -option ctrl:swapcaps
  else
    echo "Error: setxkbmap is not installed."
  fi
}

# Convert a date string to a UNIX timestamp in seconds. The date string format
# is the one described in the 'date' man page as '--date=STRING'.
#   Usage: date2ts <date>
date2ts() {
  date -d "$1" '+%s'
}

# Convert a UNIX timestamp in seconds to a date string. The format of the
# output date string can be optionally specified (e.g. '+%Y-%m-%d %H:%M:%S').
#   Usage: ts2date <timestamp> [<out_format>]
ts2date() {
  if is_set "$2"; then date -d "@$1" "$2"
  else                 date -d "@$1"
  fi
}

# Check if the dependencies of a Debian package are installed
checkdep() {
  dep=($(apt-cache depends "$1" | grep Depends: | cut -d : -f 2))
  for d in "${dep[@]}"; do
    echo -n "$d: "
   if dpkg -s "$d" 2>/dev/null | grep -q "Status: .* installed"; then
      echo installed
    else
      echo "NOT INSTALLED"
    fi
  done
}

# Install Docker (tested on Ubuntu)
install-docker() {
  sudo apt-get update
  sudo apt-get -y install docker.io
}

# Install Certbot (on Ubuntu)
install-certbot() {
  sudo apt-get update
  sudo apt-get -y install software-properties-common
  sudo add-apt-repository ppa:certbot/certbot
  sudo apt-get update
  sudo apt-get -y install certbot 
}
