# ~/.bashrc.tmp
#
# Temporary stuff that should either be deleted from time to time, or incorp-
# orated into a stable .bashrc.* file.
#------------------------------------------------------------------------------#

#------------------------------------------------------------------------------#
# Terraform
#------------------------------------------------------------------------------#

if _is-installed terraform; then
  # Aliases
  alias tf=terraform
  alias tfa='terraform apply'
  alias tfd='terraform destroy'
  alias tfaa='terraform apply --auto-approve'
  alias tfdd='terraform destroy --auto-approve'

  # Enable command completion
  if _is-mac && _is-installed brew; then
    complete -C $(brew --prefix)/bin/terraform terraform
  elif _is-linux; then
    complete -C /usr/bin/terraform terraform
  fi
fi

#------------------------------------------------------------------------------#
# Prometheus
#------------------------------------------------------------------------------#

# Display only the distinct metric names from a page of Prometheus metrics
prom-distinct() {
  sed '/^#/d;s/[{ ].*$//' | uniq
}

# Reduce a Prometheus metrics response to metric names and help texts
prometheus-clean() {
  # Remove labels and values (keep only metric names)
  sed '/^[^#]/s/[ {].*$//' |
  # Delete duplicate metric names
  uniq |
  # Remove TYPE comments
  sed '/^# TYPE/d' |
  # Simplify HELP comments (strip HELP keyword and metric name)
  sed '/^# HELP/s/HELP [^ ]* //'
}

#------------------------------------------------------------------------------#
# Misc
#------------------------------------------------------------------------------#

# Use Grip [1] with a GitHub PAT to avoid the anonymous user rate limit
# [1] https://github.com/joeyespo/grip
alias grip='grip --user weibeld --pass $(cat ~/.config/grip/personal-access-token)'

# Open a JMESPath Terminal [1]
# [1] https://github.com/jmespath/jmespath.terminal)
jpterm() {
  python /Users/dw/Library/Python/2.7/lib/python/site-packages/jpterm.py
}
